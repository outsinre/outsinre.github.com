---
layout: post
title: Emacs LSP
---

1. toc
{:toc}

# LSP #

[Language Server Protocol (LSP)](https://microsoft.github.io/language-server-protocol/) is originally from Mircosoft and now develops to a standard protocol.

LSP works in a client/server mode. In this post, the client is usually package of IDE (e.g. Emacs), while the server is specific to programing language (e.g. C/C++).

To configure Emacs with LSP support, we firstly, install the *eglot* in Emacs, then install a language-specific LSP server on your host, and might do some setup in *init.el* depending on the LSP server requirement.

# Emacs eglot #

Emacs supports LSP by its built-in package [eglot](https://github.com/joaotavora/eglot) or 3rd-party package [emacs-lsp](https://github.com/emacs-lsp/lsp-mode).

*eglot* has less features but requires less dependencies. What is more, it is official!

To install the *eglot* client, just run `M-x package-install RET eglot RET`.

# C/C++ LSP Server #

Install the C/C++ LSP server [clangd](https://clangd.llvm.org/installation) on Arch Linux.

```bash
~ $ sudo pacman -S clang

~ $ clangd --version
```

# Run eglot #

Make sure the value of variable *eglot-server-programs* contains `c-mode` and `c++-mode`. All the languages major mode listed [here](https://github.com/joaotavora/eglot#connecting-to-a-server) in is enabed by default.

Please open up a C/C++ source file and run `M-x eglot`. You will find LSP server *clangd* is automatically launched on your host, as the child process of Emacs. To shutdown the LSP server, just run `M-x eglot-shutdown`.

However, we'd like to automatically launch the LSP server upon a C/C++ source file is loaded. Add the following contents *init.el*.

```lisp
(require 'eglot)
(add-hook 'c-mode-hook 'eglot-ensure)
(add-hook 'c++-mode-hook 'eglot-ensure)
```
