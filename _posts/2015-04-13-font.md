---
layout: post
title: Font
---

# Font

1. Applications use fonts by font systems.
2. Font systems includes XLFD and XFT (requires Fontconfig).

   Two different font systems are used by X11: the older or core X Logical Font Description, XLFD, and the newer X FreeType, Xft, systems. XLFD was originally designed for bitmap fonts and support for scalable fonts (Type1, TrueType and OpenType) was added later. XLFD does not support anti‑aliasing and sub‑pixel rasterization. Xft uses the FreeType and Fontconfig libraries and is more suitable when the smooth appearance of fonts is desired. 
3. Application decides to use which font system. Most modern applications use XFT.

   Only some ancient ones use XLFD (I have not found one yet).
4. For fonts to be known to applications, they must be cataloged for easy and quick access.
5. To see a list of known Fontconfig fonts:

   ```
   $ fc-list : file
   ```

   1. See man fc-list for more output formats.
   2. Fontconfig search *recursively* through font config.
6. Check for Xorg's known Font Path by reviewing its log:

   ```
   $ grep /fonts /var/log/Xorg.0.log
   or
   $ xset q
   ```

   1. Although X11 uses XFT (Fontconfig), Xorg scans Font Path on startup.
   2. Xorg does not search *recursively* within Font Path. So the font full path should be specified when configuring Font Path.

# Fontconfig

Fontconfig is a library designed to provide system-wide font configuration, customization and application access. On Unix-like sytems, it is the main tool to manage fonts.

1. Read [fonts-conf](http://freedesktop.org/software/fontconfig/fontconfig-user.html); [Jin Buguo](http://www.jinbuguo.com).
2. Everything starts with */etc/fonts/fonts.conf*.
3. [XDG Base Directory Specification](https://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html)

   This specification defines where these files should be looked for by defining one or more base directories relative to which files should be located. You can find out where is the default value for *XDG_DATA_HOME*, *XDG_CONFIG_HOME*, etc.

   BTW, different from *XDG base directory*, [xdg-user-dirs](https://www.freedesktop.org/wiki/Software/xdg-user-dirs/) refers to Desktop, Documents, Downloads, Pictures, Templates etc.
4. Try *fc-list*, *fc-query*, *fc-match* etc. commands.
5. Currently I use [Linux字体美化实战(Fontconfig配置)](http://www.jinbuguo.com/gui/linux_fontconfig.html) this scheme. The only difference is removing Korea fonts part.

## Per-user installation

Get fonts like `*.ttf` and `*.otf`:

```
MTEXTRA.TTF   fonts.dir    msyhbd.ttc   simhei.ttf  symbol.ttf    webdings.ttf
WINGDNG2.TTF  fonts.scale  msyhl.ttc    simkai.ttf  tahoma.ttf    wingding.ttf
WINGDNG3.TTF  msyh.ttc     simfang.ttf  simsun.ttc  tahomabd.ttf
```

Commands:

```bash
$ mkdir -p ~/.local/share/fonts/winfonts
$ cd ~/.local/share/fonts/winfonts
$ cp /path/to/font-files ./
$ fc-cache -fv ./
$ mkfontscale ./ && mkfontdir ./ (opt)
```

The last two commands *mkfontscale* and *mkfontdir* are for very ancient applications (i.e. GTK+1, xfontsel) using XLFD.

## System-wide installation

Install system-wide fonts are similar except that the fonts directories are different like */usr/share/fonts/*.

```bash
# mkdir /usr/share/fonts/winfonts
# chmod 755 /usr/share/fonts/winfonts
# cd /usr/share/fonts/winfonts
# cp /path/to/font-files ./
# chmod -R 644 ./*
# fc-cache -fv ./*
# mkfontscale ./ && mkfontdir ./ (opt)
```

# Xserver support (opt)

Most of time, Fontconfig works out of box without any further configuration.

For Xserver to load fonts directly (as opposed to the use of a font server - Fontconfig), the directory for your newly added font must be added with a *FontPath* entry. This entry is located in the *Files section* of your Xorg configuration file. An official example is */usr/share/doc/xorg-server-1.18.4/xorg.conf.example.bz2*.

Create */etc/X11/xorg.conf.d/10-fonts-xorg.conf*:

```
Section "Files"
# Multiple FontPath entries are allowed (which are concatenated together),
# as well as specifying multiple comma-separated entries in one FontPath
# command (or a combination of both methods).
# The default path is shown here.
#    FontPath	/usr/share/fonts/misc/,/usr/share/fonts/TTF/,/usr/share/fonts/OTF/,/usr/share/fonts/Type1/,/usr/share/fonts/100dpi/,/usr/share/fonts/75dpi/

    FontPath "/usr/share/fonts/misc"
    FontPath "/usr/share/fonts/100dpi"
    FontPath "/usr/share/fonts/75dpi"
    FontPath "/usr/share/fonts/util"
    FontPath "/usr/share/fonts/encodings"
    ...
    FontPath "/usr/share/fonts/winfonts"
EndSection
```

1. FontPath entry can be a single font path or multiple comma-separated font paths (or a combination of both).
2. There are several default font paths (i.e. 100dpi, 75dpi etc.) which are always scanned.
3. Font paths must be quoted.

## Per-user configuration

Settings Font Path under */etc/X11/xorg.conf.d/* are system-wide effective. For per-user setting, add

```
xset +fp /usr/share/fonts/dejavu/           # Prepend a custom font path to Xorg's list of known font paths
```

to *~/.xinitrc*. To remove a Font Path, use *-fp* instead.

# Sphere - infinality

*infinality* USE can be enabled globally in */etc/portage/make.conf*.

```bash
# echo "media-libs/freetype adobe-cff infinality" > /etc/portage/package.use/freetype
# emerge -av media-libs/freetype
# eselect fontconfig list
# eselect fontconfig enable 52-infinality.conf
```

*fontconfig-infinality* will draw in its own settings (*/etc/fonts/infinality*) which will interfere with the other fontconfig configuration. It's recommended to disable most of Fontconfig options while keeping *52-infinality.conf*. Specially, configurations related to specific fonts can be kept like *62-croscore-\**.conf* and *57-dejavu-\*.conf*.

You will find *fontconfig* (*/etc/fonts/*) and *infinality* (*/etc/fonts/infinality/*) has the nearly the same directory architecture. The *conf.d* sub-directory stores the selected symlinks, while *conf.avail* (or *conf.src*) stores all existing configurations. We use *eselect* which chooses and creates symbolic links under *conf.d* sub-directory.

Optionally, refer to reference number 3, set `embeddedbitmap` in `/etc/fonts/infinality/infinality.conf` to `true`.

## *infinality* symlinks

```bash
# eselect lcdfilter list
# eselect lcdfilter set 14, set to *windows-7*
# eselect infinality list
# eselect infinality set to *win7*
```

Make sure *lcdfilter* and *infinality* choose the same category.

# Reference:

1. [Gentoo Linux on T43 (7) 中文字体](http://ted.is-programmer.com/categories/1547/posts)
2. [字体配置local.conf详解[带Win效果和AA效果]](https://www.freebsdchina.org/forum/viewtopic.php?t=34824&start=0&postdays=0&postorder=asc&highlight=)
3. [gentoo 下字体美化该如何设置](https://groups.google.com/forum/#!topic/gentoo-china/gzW8mg9OIhg)
4. [在Gentoo上配置Infinality](https://gist.github.com/kidlj/f30e82c2c6f064990596)
5. [Gentoo Fontconfig](https://wiki.gentoo.org/wiki/Fontconfig).
