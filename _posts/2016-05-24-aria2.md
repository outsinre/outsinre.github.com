---
layout: post
title: aria2 + webui
---

> *aria2* is a Linux command line counterpart of Windows Thunder/IDM, which supports URL, BT/PT, metalink etc. Make it simple, configure a GUI like Webui-aria2 or YAAW based on its builtin RPC (JSON or XML) support.

# Installation

```bash
# echo "net-misc/aria2 bittorrent metalink" > /etc/portage/package.use/aria2
# emerge -avt aria2
```

1. If you prefer XML RPC to default JSON RPC, enable `xmlrpc scripts` USEs.

   ???adns USE
2. We can invoke *aria2* command - *aria2c*.

   Refer to [official examples](https://aria2.github.io/manual/en/html/aria2c.html#example).
3. To fully utilize functionalities, we can:
   1. Enable RPC and daemon;
   2. Put common arguments in configuration file;
   3. Install *webui-aria2* and enable *directurl*;
   4. Set alias for different configurations.

# Configuration

1. If you don't bother remembering arguments like me, speicify the common ones in *$HOME/.aria2/aria2.conf* or *$XDG_CONFIG_HOME/aria2/aria2.conf*.
2. You can also specify the path to configuration file using `--conf-path` option if it's not in the default locations.
3. Current version is 1.15.2 and limited:
   1. *${HOME}* or *~* cannot be parsed in configuration file. Use absolute path.
   2. Does not support *$XDG_CONFIG_HOME/aria2/aria2.conf*. Use `--conf-path` argument manually.
   3. More options are only available in newer versions:

```
# https://1024coder.com/topic/15
# https://gist.github.com/aa65535/5e956c4eb4f451ddec29
# http://aria2c.com/usage.html
# http://blog.binux.me/2012/12/aria2-examples/
#
# Version 1.15.2 does not support ${HOME} or ~ in .conf

# Log
#
log=/home/jim/.local/share/aria2/aria2.log
log-level=debug
summary-interval=120

# Disk
#
dir=/home/jim/Downloads
# Allocates file space before download begins
# This may take some time depending on file size
# and filesystem
# NTFS: falloc; Ext3/4: trunc
# Refer to `dir' option
file-allocation=none
#enable-mmap=true
# >= 1.16
#disk-cache=32M

# Concurrency
#
# Resume a download started by a web browser or another program
# which downloads files sequentially from the beginning
continue=true
# maximum downloads
max-concurrent-downloads=3
# maximum connections to one server per download
max-connection-per-server=3
# connections/threads per download 
split=5
# split if file >= 2*5M=10M
min-split-size=5M
# overall limit
max-overall-upload-limit=1K
max-overall-upload-limit=0
# Avoid terribly slow AAAA record lookup
disable-ipv6=true

# Session
#
input-file=/home/jim/.local/share/aria2/aria2.session
save-session=/home/jim/.local/share/aria2/aria2.session
# >= 1.16.1
#save-session-interval=60

# RPC
#
daemon=true
enable-rpc=true
rpc-allow-origin-all=true
# If used in OpenWRT, use 'true'
#rpc-listen-all=false
# Customize port number if the default is occupied
#rpc-listen-port=6800
rpc-user=aria2
rpc-passwd=aria2c
# better but >= 1.18.4
#rpc-secret=token

# BT/PT
#
#follow-torrent=true
#bt-max-peers=55
#listen-port=6881-6999
#dht-listen-port=6881-6999
#bt-request-peer-speed-limit=50K

# schedulled command; useful in OpenWRT
#on-download-complete=exit
```

## PT camouflage

1. PT sites (mainly those on campus) forbid *arai2* clients. We should disguise it behaving like a normal *uTorrent*.

```
# PT camouflage
#
# https://www.librehat.com/aria2-camouflage-utorrent-pt-download/
# http://tieba.baidu.com/p/2894158631
# http://kzpu.com/archives/3526.html
enable-dht=false
enable-dht6=false
bt-enable-lpd=false
enable-peer-exchange=false
user-agent=uTorrent/341(109279400)(30888)
peer-id-prefix=-UT341-
seed-ratio=0
# No this option in 1.15.2
#force-save=true
bt-hash-check-seed=true
bt-seed-unverified=true
bt-save-metadata=true
```

# [webui-aria2](https://github.com/ziahamza/webui-aria2)

```bash
$ cd ~/workspace/
$ git clone https://github.com/ziahamza/webui-aria2.git
$ cd webui-aria2
$ nano -w configuration.js
```

1. Set *user* and *pass* in *configuration.js*;
2. Open the *index.html* in Firefox.

## *directurl*

This feature allows users to download files that they download from aria2 directly from the webui dashboard. Suppose *aria2* is downloading on remote host, *directurl* generates clickable link to download downloaded file from remote host. Simplest way is to use Python to setup a HTTP server.

```
$ cd ~/workspace/webui-aria2
$ python -m SimpleHTTPServer 8080 >/dev/null &
```

1. Set *directURL* to *'http://localhost:8080/'* in *configuration.js*;
2. Access *http://localhost:8080*.

# Alias

1. We need different set of arguments for different downloads.

   For example, to download PT resources, we should camouflage *aria2* as *uTorrent*. But options for PT impact BT download performance. We can set an alias for PT by `--conf-path`.
2. Don't bother launching HTTP srever manually each time.

```
$ nano -w ~/.bashrc
alias aria2c='aria2c --conf-path=${HOME}/.config/aria2/aria2.conf; cd ${HOME}/workspace/webui-aria2/; python -m SimpleHTTPServer 8080 >/dev/null &'
alias aria2cpt='aria2c --conf-path=${HOME}/.config/aria2/aria2pt.conf; cd ${HOME}/workspace/webui-aria2/; python -m SimpleHTTPServer 8080 >/dev/null &'
$ source ~/.bashrc
```

# Launch

1. Launch RPC daemon

   ```bash
   $ type aria2c aria2cpt
   $ aria2c
   ```
   
2. Open WebUI in broswer *http://localhost:8080*.

# Browser plugins

TO-DOs

1. Plugins for BaiduYun.
2. Plugins to lauch *aria2*.

# Refs

1. [VPS下使用aria2进行BT下载及其WebUi配置](https://1024coder.com/topic/15)
2. [Aria2的配置文件 & 启动脚本](https://gist.github.com/aa65535/5e956c4eb4f451ddec29)
3. [Aria2 & YAAW 使用说明](http://aria2c.com/usage.html)
4. [aria2配置示例](http://blog.binux.me/2012/12/aria2-examples/)
5. [Aria2伪装uTorrent进行PT下载](https://www.librehat.com/aria2-camouflage-utorrent-pt-download/)
6. [aria2亦可以用于PT下载](http://tieba.baidu.com/p/2894158631)
7. [Aria2伪装uTorrent进行PT下载](http://kzpu.com/archives/3526.html)
